<html>
    <head>
        <title>Simplified Media Center</title>
    </head>
    
    <!--INCLUDING SOCKET IO-->
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        var socket = io();

        var cur_dir = "";

        function change_dir(new_dir){
            /*
                Function to change the current direction

                RETURN:
                    - function to change the current direction to new_dir
            */
            return function(){

                var path_lst = new_dir.split('/');
                path_lst = path_lst.filter(x => x !== ''); 
                cur_dir = path_lst.join('/');
               
                load_dir()
            }
        }
        
        function load_dir(){

            /*
                Emit the load_dir signal to server
            */

            socket.emit("load_dir", cur_dir);     
        }
        
        // Load directory when the page is loaded    
        window.onload = load_dir;
        /*
        function load_media(media_url){
            // Load media with the url
            return function() {
                socket.emit("load", media_url)
            };
        }
        */

        function load_with_id(id){
            // Load media with the ud
            return function() {
                socket.emit("load_id", id)
            };
        }

        function search_submit(){
            var query = document.getElementById("search_text").value;
            console.log(query);

            socket.emit("query", query)
        }
        
        socket.on("query_res", function(rows){
            var ul = document.getElementById("media_list");
            ul.innerHTML = "";
            
            rows.forEach(function(item){
                // Creating button element
                var li = document.createElement("li");
                var media_button = document.createElement("button");
                media_button.addEventListener('click', load_with_id(item.id));
                
                // Add to stuff 
                media_button.appendChild(document.createTextNode(item.title));
                li.appendChild(media_button);
                ul.appendChild(li);
            });
            // Create button elements from data
        });

        socket.on("play", function(media_url){

            var viewer = document.getElementById("play_viewer");
            var viewer_src = document.getElementById("viewer_source");
            viewer_src.src = media_url;

            viewer.load();
        })

    </script>

    <body>
        <div id="search_bar">
            <input type="text" id="search_text" placeholder="howdy">
            <button type="button" onclick="search_submit()">Search</button>
        </div>

        <div id="media_viewer_container">
            <video id="play_viewer" controls width=400 heigh=600>
                <source id="viewer_source" src="/video/0" type="video/mp4">
            </video> 
        </div>

        <div id="media_list_container" style="width: 100%; height: 300px; overflow-y: scroll;">

            <button id="back_button" style="background-color: #f44336;color: white;">Back</button>

            <ul id="media_list">
            </ul>

        </div>
    </body>
</html>
